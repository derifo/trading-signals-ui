"use strict";angular.module("app",["ngAnimate","ngMessages","ngResource","ngTouch","ngRoute","smart-table","ui.router","smart-table","toastr","daterangepicker","countUpModule","easypiechart","ngNotify","angular-loading-bar","ui.bootstrap-slider","app.common.services","app.common.directives","app.states.layout","app.states.charts","app.states.signals","app.states.grids","app.core.dashboard","app.core.signals","app.core.trades","app.core.security"]).config(["$httpProvider","$stateProvider","$urlRouterProvider",function(a,s,r){a.defaults.useXDomain=!0,a.defaults.withCredentials=!0,delete a.defaults.headers.common["X-Requested-With"],a.defaults.headers.common={},a.defaults.headers.post={"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},a.defaults.headers.put={},a.defaults.headers.patch={},a.defaults.transformRequest=function(a){return void 0===a?a:$.param(a)},r.otherwise("/")}]).run(["$rootScope","$http","$state","ngNotify",function(a,s,r,n){n.config({position:"top",duration:4e3,html:!0}),s.defaults.transformResponse.unshift(function(a,s,n){return 401==n&&"app.security.login"!=r.current.name&&r.go("app.security.login"),a}),a.$on("$stateChangeSuccess",function(){"app.security.login"!=r.current.name&&s.get(sConfig.api+"api/traders/is_logged")}),s.appendTransform=function(a){return a=angular.isArray(a)?a:[a],a.concat(s.defaults.transformResponse)}}]),angular.module("app.common.directives",[]),angular.module("app.common.filters",[]),angular.module("app.common.services",["ngResource"]),angular.module("app.states.charts",[]),angular.module("app.states.grids",[]),angular.module("app.states.layout",["ui.router"]).config(["$stateProvider",function(a){a.state("app",{url:"/","abstract":!0,views:{"header@":{templateUrl:"app/common/states/layout/header/header.tpl.html",controller:"app.states.layout.headerCtrl"},"navbar@":{templateUrl:"app/common/states/layout/navbar/navbar.tpl.html",controller:"app.states.layout.navbarCtrl"}}})}]).run(["$rootScope",function(a){a.image=function(a){return"/images/"+a}}]),angular.module("app.states.signals",[]),angular.module("app.core.security",["ui.router"]).config(["$stateProvider",function(a){a.state("app.security",{url:"auth/","abstract":!0}),a.state("app.security.login",{url:"login",views:{"content@":{templateUrl:"/app/core/security/login/login.tpl.html",controller:"app.core.security.loginCtrl"},"navbar@":{templateUrl:"app/common/states/layout/navbar/navbar.tpl.html",controller:"app.states.layout.navbarCtrl"}}})}]),angular.module("app.core.dashboard",["ui.router"]).config(["$stateProvider",function(a){a.state("app.dashboard",{url:"",data:{signalsList:{limit:4}},views:{"content@":{templateUrl:"/app/core/dashboard/dashboard.tpl.html",controller:"app.core.dashboardCtrl"},"tiles@app.dashboard":{templateUrl:"/app/common/states/charts/tiles/tiles.tpl.html",controller:"app.charts.tiles"},"statistics@app.dashboard":{templateUrl:"/app/common/states/charts/statistics/statistics.tpl.html",controller:"app.charts.statistics"},"signalsList@app.dashboard":{templateUrl:"/app/common/states/signals/list/list.tpl.html",controller:"app.signals.list"},"membersTrades@app.dashboard":{templateUrl:"/app/common/states/charts/members-trades/members-trades.tpl.html",controller:"app.charts.membersTrades"},"openTrades@app.dashboard":{templateUrl:"/app/common/states/grids/open-trades/open-trades.tpl.html",controller:"app.grids.openTrades"}}})}]),angular.module("app.core.signals",["ui.router"]).config(["$stateProvider",function(a){a.state("app.signals",{url:"signals","abstract":!0}),a.state("app.signals.live",{url:"",views:{"content@":{templateUrl:"/app/core/signals/live/live.tpl.html",controller:"app.core.signals.liveCtrl"}}}),a.state("app.signals.history",{url:"/history",views:{"content@":{templateUrl:"/app/core/signals/history/history.tpl.html",controller:"app.core.signals.historyCtrl"}}})}]),angular.module("app.core.trades",["ui.router"]).config(["$stateProvider",function(a){a.state("app.trades",{url:"trades","abstract":!0}),a.state("app.trades.open",{url:"",views:{"content@":{templateUrl:"/app/core/trades/open/open.tpl.html",controller:"app.core.trades.openCtrl"}}}),a.state("app.trades.history",{url:"/history",views:{"content@":{templateUrl:"/app/core/trades/history/history.tpl.html",controller:"app.core.trades.historyCtrl"}}})}]),angular.module("app.common.services").factory("merchantsSignalsAPI",["$resource",function(a){return a(sConfig.api+"api/traders/merchants/signals/:id",{},{query:{method:"GET",isArray:!0},save:{method:"POST",params:{id:"@id"}}})}]),angular.module("app.common.services").factory("signalsAPI",["$resource","$http",function(a,s){return a(sConfig.api+"api/traders/signals/:id",{},{query:{method:"GET",isArray:!0},buy:{method:"POST",url:sConfig.api+"api/traders/buy"},save:{method:"POST",params:{id:"@id"}}})}]),angular.module("app.common.services").factory("tradersAPI",["$resource","$http",function(a,s){return a(sConfig.api+"api/traders/traders",{},{query:{method:"GET",isArray:!0},getStatistics:{method:"GET",url:sConfig.api+"api/traders/traders/stats"},save:{method:"POST",params:{id:"@id"}},login:{method:"POST",url:sConfig.api+"api/traders/login"},logout:{method:"POST",url:sConfig.api+"api/traders/logout"}})}]),angular.module("app.common.services").factory("tradesAPI",["$resource","$http",function(a,s){return a(sConfig.api+"api/traders/trades/:id",{},{query:{method:"GET",isArray:!0},save:{method:"POST",params:{id:"@id"}}})}]),angular.module("app.common.directives").directive("candleStick",["$timeout",function(a){return{restrict:"E",scope:{csData:"=",options:"="},link:function(a,s){function r(r,n){function t(){e.zoomToIndexes(e.dataProvider.length-10,e.dataProvider.length-1)}var e=AmCharts.makeChart(s[0],{type:"serial",theme:"light",dataDateFormat:"YYYY-MM-DD HH:NN:SS",valueAxes:[{position:"left",guides:[{toValue:a.options.max_rate,value:a.options.min_rate,lineColor:"blue",lineAlpha:1,fillAlpha:.07,fillColor:"blue",dashLength:2,inside:!0},{toValue:a.options.open_rate,value:a.options.open_rate,lineColor:"navy",lineAlpha:1,dashLength:2,inside:!0,labelRotation:90,fontSize:"15",label:"Signal Rate"}]}],graphs:[{id:"g1",balloonText:"Open:<b>[[open]]</b><br>Low:<b>[[low]]</b><br>High:<b>[[high]]</b><br>Close:<b>[[close]]</b><br>",closeField:"close",fillColors:"green",highField:"high",lineColor:"#000000",lineAlpha:1,lowField:"low",fillAlphas:.9,negativeFillColors:"#db4c3c",negativeLineColor:"#000000",openField:"open",title:"Price:",type:"candlestick",valueField:"close"}],chartScrollbar:{graph:"g1",graphType:"line",scrollbarHeight:30},chartCursor:{valueLineEnabled:!0,valueLineBalloonEnabled:!0},categoryField:"date",categoryAxis:{parseDates:!0,minPeriod:"10mm"},dataProvider:r,"export":{enabled:!0,position:"bottom-right"}});e.addListener("rendered",t),t()}s.addClass("candle-stick-custom");a.$watch("csData",function(){var s=a.options||{};r(a.csData,s)})}}}]),angular.module("app.common.directives").directive("countdown",["$interval",function(a){return{restrict:"A",scope:{endTime:"@"},link:function(s,r){function n(a){var s=Date.parse(a)-Date.parse(new Date),r=Math.floor(s/1e3%60),n=Math.floor(s/1e3/60%60),t=Math.floor(s/36e5);return{total:s,hours:t>9?t:"0"+t,minutes:n>9?n:"0"+n,seconds:r>9?r:"0"+r}}function t(s){function t(){var a=n(s);r.text(a.hours+":"+a.minutes+":"+a.seconds),a.total<=0&&clearInterval(e)}t();var e=a(t,1e3)}t(new Date(Date.parse(s.endTime)))}}}]),angular.module("app.common.directives").directive("score",function(){return{restrict:"A",scope:{score:"@"},link:function(a,s){for(var r=a.score/20,n=1;5>=n;n+=1)r>=n?s.append($("<span></span>",{"class":"fa fa-star"})):r+.5>=n?s.append($("<span></span>",{"class":"fa fa-star-half-o"})):s.append($("<span></span>",{"class":"fa fa-star-o"}))}}}),angular.module("app.common.services").service("assetFeed",["$timeout",function(a){var s=io("http://52.48.242.152:8080");s.emit("feed-all");var r={},n={},t=function(a){r[a]||(s.emit("add-feed",[a]),s.on("feed_"+a,function(s,r){console.log("Feeded !"),s=JSON.parse(s),i(a,s,r)}),r[a]=!0)},e=function(a,s){n[a]=n[a]||[],n[a].push(s)},i=function(a,s,r){n[a].length&&n[a].forEach(function(a){a(s,r)})};return{subscribe:function(a,s){t(a),e(a,s)}}}]),angular.module("app.common.directives").directive("compareTo",function(){return{require:"ngModel",scope:{otherModelValue:"=compareTo"},link:function(a,s,r,n){n.$validators.compareTo=function(s){return s==a.otherModelValue},a.$watch("otherModelValue",function(){document.activeElement==s[0]&&n.$validate()})}}}),angular.module("app.common.services").constant("userToken",{}),angular.module("app.states.charts").controller("app.charts.tiles",["$scope","tradersAPI","$rootScope",function(a,s,r){var n=function(){s.getStatistics().$promise.then(function(s){s.win_rate=parseFloat(100/s.total_trades*s.wins).toFixed(2),a.stats=s})};n(),r.$on("traderSignalBought",n)}]),angular.module("app.states.layout").controller("app.states.layout.headerCtrl",["$scope","$interval","$state",function(a,s,r){a.$state=r}]),angular.module("app.states.layout").controller("app.states.layout.navbarCtrl",["$scope","tradersAPI","$state",function(a,s,r){a.logout=function(){s.logout().$promise.then(function(){r.transitionTo("app.security.login")})}}]),angular.module("app.states.signals").controller("app.signals.list",["$scope","merchantsSignalsAPI","signalsAPI","$state","assetFeed","$filter","ngNotify","$rootScope",function(a,s,r,n,t,e,i,l){a.buyOptions={amount:50},a.openIndex=0,s.query(n.current.data.signalsList,function(s){s.forEach(function(s){s.chartData=[],s.options={max_rate:s.signal.max_entry_rate,min_rate:s.signal.min_entry_rate,open_rate:s.signal.creation_rate},t.subscribe(s.signal.asset.socket_id,function(r,n){a.$apply(function(){s.chartData=[],s.rateStatus=s.currentRate>n?"up":"down",s.currentRate=n,angular.forEach(r,function(a,r){r=r.replace(" ","T"),s.chartData.push({date:e("date")(Date.parse(r),"yyyy-MM-dd HH:mm:ss"),high:a.high,low:a.low,open:a.open,close:a.close})})})})}),a.signals=s}),a.infoClicked=function(s){a.openIndex!=s&&($(".signal-info").slideUp(400,function(){$(this).not($(".signal-info").eq(s)).addClass("hidden")}),$(".signal-info").eq(s).removeClass("hidden").slideDown(),a.openIndex=s)},a.buySignal=function(s){a.buyOptions.buying=!0;var n={signal_id:s.signal.id,amount:a.buyOptions.amount};r.buy(n).$promise.then(function(s){1==s.status?(i.set("Your trade has successfully placed","success"),l.$emit("traderSignalBought")):i.set("There was an issue placing your trade, please try again later or buy anther signal","error"),a.buyOptions.buying=!1})}}]),angular.module("app.states.grids").controller("app.grids.openTrades",["$scope","tradesAPI","assetFeed",function(a,s,r){a.rowCollection=s.query(),a.getters={firstName:function(a){return a.firstName.length}},a.rates={},a.getRate=function(s){return a.rates[s]=a.rates[s]||0,r.subscribe(s,function(r,n){a.rates[s]=n}),a.rates[s]}}]),angular.module("app.states.charts").controller("app.charts.statistics",["$scope","tradersAPI",function(a,s){s.getStatistics().$promise.then(function(a){}),a.percent=65,a.options={easing:"easeOutElastic",delay:3e3,barColor:"#69c",trackColor:"#ace",scaleColor:!1,lineWidth:16,trackWidth:16,lineCap:"butt"},$(".epie").easyPieChart({})}]),angular.module("app.states.charts").controller("app.charts.membersTrades",["$scope","tradersAPI",function(a,s){}]),angular.module("app.core.dashboard").controller("app.core.dashboardCtrl",["$scope","tradersAPI","$timeout",function(a,s,r){}]),angular.module("app.core.security").controller("app.core.security.loginCtrl",["$scope","$timeout","tradersAPI","$state",function(a,s,r,n){a.formSubmitted=function(){var s={email:a.credentials.email,password:a.credentials.password};a.submitted=!0,r.login(s).$promise.then(function(s){s.error?a.error="Invalid email or password combination":n.transitionTo("app.dashboard")})}}]),angular.module("app.core.signals").controller("app.core.signals.historyCtrl",["$scope","tradersAPI","$timeout",function(a,s,r){}]),angular.module("app.core.dashboard").controller("app.core.signals.liveCtrl",["$scope","tradersAPI","$timeout",function(a,s,r){}]),angular.module("app.core.trades").controller("app.core.trades.historyCtrl",["$scope","tradersAPI","$timeout",function(a,s,r){}]),angular.module("app.core.dashboard").controller("app.core.trades.openCtrl",["$scope","tradersAPI","$timeout",function(a,s,r){}]);