"use strict";angular.module("app",["ngAnimate","ngMessages","ngResource","ngTouch","ngRoute","smart-table","ui.router","toastr","chart.js","daterangepicker","countUpModule","angular-loading-bar","app.common.services","app.common.directives","app.states.layout","app.states.charts","app.core.customers","app.core.security"]).config(["$httpProvider","$stateProvider","$urlRouterProvider",function(a,r,e){r.state("app",{url:"/","abstract":!0}),a.defaults.useXDomain=!0,a.defaults.withCredentials=!0,delete a.defaults.headers.common["X-Requested-With"],a.defaults.headers.common={},a.defaults.headers.post={"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},a.defaults.headers.put={},a.defaults.headers.patch={},a.defaults.transformRequest=function(a){return void 0===a?a:$.param(a)},e.otherwise("/")}]).run(["$http","$state",function(a,r){a.defaults.transformResponse.unshift(function(a,e,t){return 401==t&&"app.security.login"!=r.current.name&&r.go("app.security.login"),a}),a.appendTransform=function(r){return r=angular.isArray(r)?r:[r],r.concat(a.defaults.transformResponse)},window.login=function(){a.post("http://localhost:8000/api/aff-ui/login",{email:"odeliaodi@gmail.com",password:"123456"})},window.logout=function(){a.post("http://localhost:8000/api/aff-ui/logout")}}]),angular.module("app.common.directives",[]),angular.module("app.common.filters",[]),angular.module("app.common.services",["ngResource"]),angular.module("app.states.charts",[]),angular.module("app.states.layout",["ui.router"]).config(["$stateProvider",function(a){a.state("app.customers",{url:"","abstract":!0,views:{"navbar@":{templateUrl:"app/common/states/layout/navbar/navbar.tpl.html",controller:"app.states.layout.navbarCtrl"}}}),a.state("app.security",{url:"auth/","abstract":!0})}]).run(["$rootScope",function(a){a.image=function(a){return"/images/"+a}}]),angular.module("app.core.customers",["ui.router"]).config(["$stateProvider","ChartJsProvider",function(a,r){a.state("app.customers.breakdown",{url:"",views:{"content@":{templateUrl:"/app/core/customers/breakdown/breakdown.tpl.html",controller:"app.core.customers.breakdownCtrl"},"customerStatusChart@app.customers.breakdown":{templateUrl:"/app/common/states/charts/customers-status/customers-status.tpl.html",controller:"app.charts.customersStatus"},"customerVmap@app.customers.breakdown":{templateUrl:"/app/common/states/charts/customers-vmap/customers-vmap.tpl.html",controller:"app.charts.customersVmap"}}}),r.setOptions({responsive:!0,maintainAspectRatio:!1})}]),angular.module("app.core.security",["ui.router"]).config(["$stateProvider",function(a){a.state("app.security.login",{url:"login",views:{"content@":{templateUrl:"/app/core/security/login/login.tpl.html",controller:"app.core.security.loginCtrl"}}})}]),angular.module("app.common.services").factory("affiliatesAPI",["$resource","$http",function(a,r){return a(sConfig.api+"api/aff-ui/affiliates",{},{query:{method:"GET",isArray:!0},getSources:{method:"GET",isArray:!0,url:sConfig.api+"api/aff-ui/sources"},save:{method:"POST",params:{id:"@id"}},login:{method:"POST",url:sConfig.api+"api/aff-ui/login"},logout:{method:"POST",url:sConfig.api+"api/aff-ui/logout"}})}]),angular.module("app.common.services").factory("customersAPI",["$resource","$http",function(a,r){var e=r.appendTransform(function(a,r,e){return 200==e&&(a=JSON.parse(a),$.each(a,function(r){a[r].tracking=JSON.parse(a[r].tracking)})),a});return a(sConfig.api+"api/aff-ui/customers/:id",{},{query:{method:"GET",isArray:!0,transformResponse:e},getStatusStats:{method:"GET",isArray:!0,url:sConfig.api+"api/aff-ui/customers/status-stats"},getCountryStats:{method:"GET",isArray:!0,url:sConfig.api+"api/aff-ui/customers/by-country"},save:{method:"POST",params:{id:"@id"}}})}]),angular.module("app.common.directives").directive("compareTo",function(){return{require:"ngModel",scope:{otherModelValue:"=compareTo"},link:function(a,r,e,t){t.$validators.compareTo=function(r){return r==a.otherModelValue},a.$watch("otherModelValue",function(){document.activeElement==r[0]&&t.$validate()})}}}),angular.module("app.common.services").constant("userToken",{}),angular.module("app.states.charts").controller("app.charts.customersStatus",["$scope","$rootScope","customersAPI",function(a,r,e){a.labels=[],a.series=["Customers","Players"],a.$on("filterClicked",function(r,t){a.data=[],e.getStatusStats(t).$promise.then(function(r){var e=[[],[]],t=[];r.forEach(function(a){t.push(a.year+"-"+((a.month>9?"":"0")+a.month)+"-"+(a.day>9?"":"0")+a.day),e[0].push(a.customers),e[1].push(a.players)}),a.data=e,a.labels=t})})}]),angular.module("app.states.charts").controller("app.charts.customersVmap",["$scope","$rootScope","customersAPI",function(a,r,e){a.$on("filterClicked",function(a,r){e.getCountryStats(r).$promise.then(function(a){var r={},e={};$.each(a,function(a,t){r[t.iso2.toLowerCase()]=t.leads,e[t.iso2.toLowerCase()]=t});var t=$("#customer-vmap"),s=t.parent();t.remove(),s.append($("<div></div>",{id:"customer-vmap"})),$("#customer-vmap").vectorMap({map:"world_en",backgroundColor:"#a5bfdd",borderColor:"#818181",borderOpacity:.25,borderWidth:1,color:"#f4f3f0",enableZoom:!0,hoverColor:"#c9dfaf",hoverOpacity:null,normalizeFunction:"linear",scaleColors:["#C8EEFF","#006491"],values:r,showTooltip:!0,onLabelShow:function(a,r,t){var s=e[t]?e[t].customers:0,o=e[t]?e[t].players:0,n=s>0?100/s*o:0;n=(n+"").substr(0,5),r.append("<div>Customers: "+s+"</div>"),r.append("<div>Players: "+o+"</div>"),r.append('<div class="text-warning">Conversion: '+n+"%</div>")}})})})}]),angular.module("app.states.layout").controller("app.states.layout.navbarCtrl",["$scope","affiliatesAPI","$state",function(a,r,e){a.logout=function(){r.logout().$promise.then(function(){e.transitionTo("app.security.login")})}}]),angular.module("app.core.customers").controller("app.core.customers.breakdownCtrl",["$scope","customersAPI","affiliatesAPI","$timeout",function(a,r,e,t){a.datePicker={options:{ranges:{Today:[moment(),moment()],Yesterday:[moment().subtract(1,"days"),moment().subtract(1,"days")],"Last 7 Days":[moment().subtract(6,"days"),moment()],"Last 30 Days":[moment().subtract(29,"days"),moment()],"This Month":[moment().startOf("month"),moment().endOf("month")],"Last Month":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")]}}},a.filters={source:"0",dateRange:{startDate:moment().subtract(30,"days"),endDate:moment()}},a.sources=e.getSources(),a.filterSubmitClicked=function(){var r={source:a.filters.source+"",from:a.filters.dateRange.startDate.format("YYYY-MM-DD HH:mm:ss"),to:a.filters.dateRange.endDate.format("YYYY-MM-DD HH:mm:ss")};a.$broadcast("filterClicked",r)},a.$on("filterClicked",function(e,t){a.data={conversion:0,customers:0,players:0},r.getStatusStats(t).$promise.then(function(r){r.forEach(function(r){a.data.customers+=parseInt(r.customers),a.data.players+=parseInt(r.players)}),a.data.conversion=100/a.data.customers*a.data.players})}),t(function(){a.filterSubmitClicked()})}]),angular.module("app.core.security").controller("app.core.security.loginCtrl",["$scope","$timeout","affiliatesAPI","$state",function(a,r,e,t){a.formSubmitted=function(){var r={email:a.credentials.email,password:a.credentials.password};a.submitted=!0,e.login(r).$promise.then(function(r){r.error?a.error="Invalid email or password combination":t.transitionTo("app.customers.breakdown")})}}]);